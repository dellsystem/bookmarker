{% extends "base.html" %}

{% block breadcrumbs %}
<div class="active section">Search</div>
{% endblock %}

{% block content %}
<div class="ui two column grid">
    <div class="column">
        <h1>Search</h1>
    </div>
    <div class="column">
        <div class="ui message">
            <code>{{ query }}</code>
        </div>
    </div>
</div>

<div class="ui divider"></div>

<div class="ui eight column grid">
    <div class="column">
        <h3>Notes ({{ results.notes|length }})</h3>
    </div>
    <div class="right aligned column">
        {% if mode == 'notes' %}
        <a href="{{ qs }}" class="ui basic blue icon button">
            <i class="minus icon"></i>
            Minimize
        </a>
        {% else %}
        <a href="{{ qs }}&mode=notes" class="ui blue icon button">
            <i class="plus icon"></i>
            Expand
        </a>
        {% endif %}
    </div>
    <div class="column">
        <h3>Terms ({{ results.terms|length }})</h3>
    </div>
    <div class="right aligned column">
        {% if mode == 'terms' %}
        <a href="{{ qs }}" class="ui basic blue icon button">
            <i class="minus icon"></i>
            Minimize
        </a>
        {% else %}
        <a href="{{ qs }}&mode=terms" class="ui blue icon button">
            <i class="plus icon"></i>
            Expand
        </a>
        {% endif %}
    </div>
    <div class="column">
        <h3>Sections ({{ results.sections|length }})</h3>
    </div>
    <div class="right aligned column">
        {% if mode == 'sections' %}
        <a href="{{ qs }}" class="ui basic blue icon button">
            <i class="minus icon"></i>
            Minimize
        </a>
        {% else %}
        <a href="{{ qs }}&mode=sections" class="ui blue icon button">
            <i class="plus icon"></i>
            Expand
        </a>
        {% endif %}
    </div>
    <div class="column">
        <h3>Books ({{ results.books|length }})</h3>
    </div>
    <div class="right aligned column">
        {% if mode == 'books' %}
        <a href="{{ qs }}" class="ui basic blue icon button">
            <i class="minus icon"></i>
            Minimize
        </a>
        {% else %}
        <a href="{{ qs }}&mode=books" class="ui blue icon button">
            <i class="plus icon"></i>
            Expand
        </a>
        {% endif %}
    </div>
</div>

{% if mode == 'notes' %}
    {% if results.notes %}
        {% include 'note_list_with_books.html' with notes=results.notes highlight=query %}
    {% else %}
    <div class="ui message">
        No notes found
    </div>
    {% endif %}
{% elif mode == 'terms' %}
    {% if results.terms %}
        {% regroup results.terms by term as term_list %}

        {% for term in term_list %}
            {% include 'term_header.html' with term=term.grouper highlight=query only %}

            {% include 'term_list_with_books.html' with occurrences=term.list query=query only %}
        {% endfor %}

    {% else %}
    <div class="ui message">
        No terms found
    </div>
    {% endif %}
{% elif mode == 'sections' %}
    {% if results.sections %}
    <br />
    {% include 'section_list.html' with sections=results.sections highlight=query show_book=True %}
    {% else %}
    <div class="ui message">
        No sections found
    </div>
    {% endif %}
{% elif mode == 'books' %}
    {% if results.books %}
    {% for book in results.books %}
        {% include 'book_header.html' with book=book highlight=query only %}
    {% endfor %}
    {% else %}
    <div class="ui message">
        No sections found
    </div>
    {% endif %}
{% else %}
<div class="ui four column grid">
    <div class="column">
        {% if results.notes %}
        <div class="ui bulleted list">
            {% for note in results.notes %}
            <div class="item">
                <a href="{{ note.get_absolute_url }}{{ qs }}">
                    <strong>{{ note.subject }}</strong>
                </a>
                from
                <a href="{{ note.book.get_absolute_url }}">
                    {{ note.book.title }}
                </a>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="ui message">
        No notes found
        </div>
        {% endif %}
    </div>
    <div class="column">
        {% if results.terms %}
        <div class="ui bulleted list">
            {% for term in results.terms %}
            {% ifchanged term.term.text %}
            <div class="item">
                <a href="{{ term.term.get_absolute_url }}{{ qs }}">
                    <strong>{{ term.term.text }}</strong>
                </a> from
                <a href="{{ term.book.get_absolute_url }}">
                    {{ term.book.title }}
                </a>
            </div>
            {% endifchanged %}
            {% endfor %}
        </div>
        {% else %}
        <div class="ui message">
        No terms found
        </div>
        {% endif %}
    </div>
    <div class="column">
        {% if results.sections %}
        <div class="ui bulleted list">
            {% for section in results.sections %}
            <div class="item">
                <a href="{{ section.get_absolute_url }}{{ qs }}">
                    <strong>{{ section.title }}</strong>
                </a> from
                <a href="{{ section.book.get_absolute_url }}">
                    {{ section.book.title }}
                </a>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="ui message">
        No sections found
        </div>
        {% endif %}
    </div>
    <div class="column">
        {% if results.books %}
        <div class="ui bulleted list">
            {% for book in results.books %}
            <div class="item">
                <a href="{{ book.get_absolute_url }}">
                    <strong>{{ book.title }}</strong>
                </a>
                {% include 'author_list.html' with authors=book.default_authors only %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="ui message">
        No book found
        </div>
        {% endif %}
    </div>
</div>
{% endif %}
{% endblock %}
