{% extends "base.html" %}

{% block breadcrumbs %}
<a class="section" href="{% url 'view_book' book.pk %}">View book</a>
<i class="right angle icon divider"></i>
<div class="active section">Add note</div>
{% endblock %}

{% block content %}
<div class="ui grid">
    <div class="thirteen wide column">
        {% include 'book_header.html' with book=book only %}
    </div>
    <div class="three wide center aligned column">
        {% if not book.is_processed %}
        <form method="post" action="{% url 'mark_complete' book.id %}">
            {% csrf_token %}
            <button class="ui fluid black icon button"
                    title="Summaries can be omitted"
                    name="mode"
                    value="processed"
                    type="submit">
               <i class="check icon"></i> Mark as processed
            </button>
        </form>
        {% endif %}
    </div>
</div>

<div class="ui divider"></div>
{% with num_notes=book.notes.count %}
{% if num_notes %}
<h3>
    Recent notes ({{ num_notes }} total)::
    <a href="{% url 'view_notes' book.pk %}">View all &raquo;</a>
</h3>
<div class="ui celled two column grid">
    <div class="column">
        {% include 'note_snippets.html' with notes=recent_notes_1 show_page=book.has_pages only %}
    </div>
    <div class="column">
        {% include 'note_snippets.html' with notes=recent_notes_2 show_page=book.has_pages only %}
    </div>
</div>
{% else %}
<div class="ui warning message">
    <div class="header">
        No notes yet!
    </div>
</div>
{% endif %}
{% endwith %}

<div class="ui segment">
    <form class="ui form" method="post">
        {% csrf_token %}
        <div class="ui fields">
            {% with error=note_form.subject.errors %}
            <div class="{% if book.has_pages %}nine{% else %}eleven{% endif %} wide {% if error %}error{% endif %} field">
                <label>Subject{% if error %} (REQUIRED){% endif %}</label>
                {{ note_form.subject }}
            </div>
            {% endwith %}
            {% if book.has_pages %}
            {% with error=note_form.page_number.errors %}
            <div class="two wide {% if error %}error{% endif %} field"
                 {% if error %}title="{{ error|join:"/" }}"{% endif %}>
                <label>Page</label>
                {{ note_form.page_number }}
            </div>
            {% endwith %}
            {% else %}
            <input type="hidden" name="note-page_number" value="1" />
            {% endif %}
            {% with error=author_form.mode.errors %}
            <div class="two wide {% if error %}error{% endif %} field"
                 {% if error %}title="{{ error|join:"/" }}"{% endif %}>
                <label>Author mode</label>
                {{ author_form.mode }}
            </div>
            {% endwith %}
            <div class="three wide field">
                <label>Author</label>
                {{ author_form.author }}
            </div>
        </div>
        <div class="ui two fields">
            <div class="field">
                <label>Quote</label>
                {{ note_form.quote }}
            </div>
            <div class="field">
                <label>Comment</label>
                {{ note_form.comment }}
            </div>
        </div>
        <div class="ui basic center aligned segment">
            <button type="submit" name="submit"
                    class="ui blue button">
                Submit
            </button>
        </div>
    </form>
</div>
{% endblock %}
